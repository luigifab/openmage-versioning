/*!
 * Copyright 2011-2023 | Fabrice Creuzot (luigifab) <code~luigifab~fr>
 * https://github.com/luigifab/openmage-versioning
 * This program is free software, you can redistribute it or modify
 * it under the terms of the GNU General Public License (GPL).
 */
window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(t,e,o){for(e=e||window,o=0;o<this.length;o++)t.call(e,this[o],o,this)});var versioning=new function(){"use strict";this.svg=null,this.width=197,this.init=function(){document.getElementById("versioning_grid_table")&&document.querySelector("table.data tbody input")?(console.info("versioning.app - hello"),this.drawGraph(self.versioningIds,self.versioningCols).initDiff()):document.getElementById("versioning_history_grid_table")&&document.querySelector("table.data tbody button")&&(console.info("versioning.app - hello"),document.querySelector("table.data tbody button").click())},this.loader=function(){document.querySelector("body").classList.add("fabload")},this.decode=function(t){return decodeURIComponent(escape(atob(t)))},this.confirmFlag=function(e,t,o){try{return apijs.dialog.dialogConfirmation(t,this.decode(o),versioning.actionConfirmFlag,e,"versioning "+document.getElementById("scmtype").textContent),!1}catch(t){console.error(t);try{apijs.dialog.actionClose()}catch(t){}try{return!!confirm(this.decode(o).replace(/\[[^\]]+]/g,""))&&(this.loader(),self.location.href=e,!0)}catch(t){return console.error(t),!!confirm(Translator.translate("Are you sure?"))&&(this.loader(),self.location.href=e,!0)}}},this.actionConfirmFlag=function(t){versioning.loader(),apijs.dialog.remove("waiting","lock"),self.location.href=t},this.cancelFlag=function(t){this.loader(),self.location.href=t},this.confirmUpgrade=function(e,o){try{return e.match(/revision\/(\w+)\//),apijs.dialog.dialogFormOptions(o.replace("ยง",RegExp.$1),this.decode(self.versioningText),e,versioning.actionConfirmUpgrade,null,"versioning "+document.getElementById("scmtype").textContent),!1}catch(t){console.error(t);try{apijs.dialog.actionClose()}catch(t){}try{var i=document.createElement("div"),r=this.decode(self.versioningText).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\[/g,"<").replace(/]/g,">"),n=document.getElementById("scmtype").textContent;return e.match(/revision\/(\w+)\//),i.innerHTML='<div class="fake options versioning '+n+' ready" id="apijsDialog"><form method="get" action="'+e+'" class="fake options versioning '+n+' ready" onsubmit="return versioning.actionConfirmUpgrade(true);" id="apijsBox"><h1>'+o.replace("ยง",RegExp.$1)+'</h1><div class="bbcode">'+r+'</div><div class="control"><button type="submit" class="confirm">Valider</button><button type="button" class="cancel" onclick="versioning.closeConfirmUpgrade();">Annuler</button></div></form></div>',document.querySelector("body").appendChild(i),document.querySelector("div.bbcode input").focus(),!1}catch(t){return console.error(t),!!confirm(Translator.translate("Are you sure?"))&&(this.loader(),!0)}}},this.closeConfirmUpgrade=function(){document.getElementById("apijsDialog").remove()},this.actionConfirmUpgrade=function(t){return!1!==t&&(versioning.loader(),!0===t?(document.querySelector("div.bbcode").setAttribute("style","visibility:hidden;"),document.querySelector("div.control").setAttribute("style","visibility:hidden;")):(apijs.dialog.remove("waiting","lock"),self.location.href=t+apijs.serialize(document.getElementById("apijsBox")).replace(/[=&]/g,"/"))),!0},this.history=function(t,e){return document.querySelectorAll("table.data tbody tr[class]").forEach(function(t){t.classList.remove("current")}),document.querySelector("pre").innerHTML=this.decode(e)+"\n\n",t.parentNode.parentNode.classList.add("current"),!1},this.drawGraph=function(i,t){var r,n,s,a,c,l,d,u,h,g,p="",e=Object.keys(i).map(function(t){return i[t]}),f=document.querySelectorAll("table.data tbody tr"),v=f.length-1,o=[],m=[],b=[],y=[],k=[],w=0;for(e.sort(function(t,e){return t.row>e.row?-1:t.row<e.row?1:0}),l=this.getTopPosition(f[0])-1,d=this.getTopPosition(f[v])+f[v].offsetHeight-l-1,this.svg=new Raphael(document.getElementById("versioning_grid_table").parentNode),this.svg.setSize(this.width,d),this.svg.canvas.setAttribute("style","top:"+l+"px;"),this.svg.canvas.setAttribute("class","k k0"),this.svg.canvas.setAttribute("id","versioning_graph"),this.svg.canvas.setAttribute("onmouseover","versioning.mouseOver(true);"),this.svg.canvas.parentNode.setAttribute("onmouseleave","versioning.mouseOver(false);"),Raphael.getColor.reset(),Raphael.getColor(),o.push(Raphael.getColor()),r=0;r<=t;r++)Raphael.getColor(),Raphael.getColor(),o.push(Raphael.getColor()),m.push("svg.k"+r+" .k:not(.k"+r+") { opacity:0.4; }"),m.push("table.k"+r+" .k:not(.k"+r+") { color:#CCC; }"),m.push("table.k"+r+" .k:not(.k"+r+") button { opacity:0; visibility:hidden; }");return e.forEach(function(t){t.color=o[t.col],t.klass="k k"+t.col,k[t.col]=t.revision,y[t.col]||(y[t.col]=t.revision)}),e.forEach(function(o){u=this.getTopPosition(f[v-o.row])-l,h=f[v-o.row].offsetHeight/2,n=u+h,r=25*o.col+20,this.svg.circle(r,n,3.5).attr("fill",o.color).attr("stroke","none").attr("class",o.klass),0<o.branch.length&&b.indexOf(o.branch)<0&&(b.push(o.branch),c=this.svg.text(r+13,n-.3,o.branch).attr("fill",o.color).attr("text-anchor","start").attr("class",o.klass),s=r+3.2+8+c.getBBox().width+7,this.svg.path("M "+(r+3.2)+","+(n-.4)+" L "+(r+3.2+8)+","+(n-.4-8)+" L "+s+","+(n-.4-8)+" L "+s+","+(n-.4+8)+" L "+(r+3.2+8)+","+(n-.4+8)+" Z").attr("stroke",o.color).attr("fill","white").attr("fill-opacity","0.7").attr("stroke-opacity","0.2").attr("class",o.klass).toFront(),c.toFront(),s>this.width)&&(this.width=s),o.parents.forEach(function(t,e){"object"==typeof(e=0<t.length?i[t]:void 0)?(u=this.getTopPosition(f[v-e.row])-l,h=f[v-e.row].offsetHeight/2,a=u+h,s=25*e.col+20,e.col===o.col?this.svg.path(["M",r,n,"V",a]).attr("stroke",o.color).attr("stroke-width",1.7).attr("class",o.klass).toBack():(p+='<linearGradient id="manGrad'+w+'" x1="0" y1="0" x2="100%" y2="0"><stop offset="0" stop-color="'+(s<r?e:o).color+'"></stop><stop offset="100%" stop-color="'+(s<r?o:e).color+'"></stop></linearGradient>',g=f[v-e.row].offsetHeight/2,g+=h,(e.revision===y[e.col]&&n+g<a?((c=this.svg.path(["M",r,n,"T",s,n+g])).node.setAttribute("stroke","url(#manGrad"+w+")"),c.attr("stroke-width",1.6).attr("class","k").toBack(),this.svg.path(["M",s,n+g,"V",a]).attr("stroke",e.color).attr("stroke-width",1.7)):((c=o.revision===k[o.col]&&n+g<a&&1===o.parents.length?(this.svg.path(["M",r,n,"V",a-g]).attr("stroke",o.color).attr("stroke-width",1.7).attr("class","k").toBack(),this.svg.path(["M",r,a-g,"T",s,a])):this.svg.path(["M",r,n,"T",s,a])).node.setAttribute("stroke","url(#manGrad"+w+")"),c.attr("stroke-width",1.6))).attr("class","k").toBack(),w+=1)):0<t.length&&this.svg.path(["M",r,n,"V",d]).attr("stroke",o.color).attr("stroke-width",1.7).attr("class",o.klass).toBack()},this),(c=f[v-o.row]).setAttribute("onclick","versioning.updateClass(this.getAttribute('class'));"),c.setAttribute("class",o.row%2<1?o.klass:"even "+o.klass),c.removeAttribute("title")},this),0<p.length&&(document.querySelector("svg defs").innerSVG=p),(c=document.createElement("style")).setAttribute("type","text/css"),c.setAttribute("id","versioning_styles"),c.appendChild(document.createTextNode(m.join("\n"))),document.querySelector("head").appendChild(c),this},this.getTopPosition=function(t){var e=document.querySelector("body").getBoundingClientRect();return t.getBoundingClientRect().top-e.top},this.mouseOver=function(t){this.svg.canvas.style.width=t?this.width+"px":"197px",this.svg.canvas.style.pointerEvents=t?"none":"inherit"},this.updateClass=function(t){this.svg.canvas.setAttribute("class",t),document.getElementById("versioning_grid_table").setAttribute("class","data "+t)},this.initDiff=function(){var e=1,o=1,i=!0;return document.querySelectorAll('table.data input[type="radio"]').forEach(function(t){t.setAttribute("onchange","versioning.goDiff("+(i?e++:o++)+", "+(i?"false":"true")+");"),t.removeAttribute("disabled"),i=!i}),document.querySelector('table.data tr:last-child input[name="d1"]').setAttribute("disabled","disabled"),document.querySelector('table.data tr:first-child input[name="d2"]').setAttribute("disabled","disabled"),document.querySelector('table.data input[name="d1"]:not([disabled])').checked=!0,document.querySelector('table.data input[name="d2"]:not([disabled])').checked=!0,this.goDiff()},this.goDiff=function(t,e){var o=document.querySelector('table.data input[name="d1"]:checked'),i=document.querySelector('table.data input[name="d2"]:checked'),r=parseInt(o.getAttribute("onchange").replace(/\D/g,""),10),n=parseInt(i.getAttribute("onchange").replace(/\D/g,""),10);return"string"==typeof t?(this.loader(),self.location.href=t):(!0===e?n<=r&&((o=i.parentNode.parentNode.previousElementSibling.querySelector('input[name="d1"]')).checked=!0):n<=r&&((i=o.parentNode.parentNode.nextElementSibling.querySelector('input[name="d2"]')).checked=!0),t=(t=(t=document.querySelector("div.content-header td.form-buttons button").getAttribute("onclick")).replace(/\/from\/[^\/]+/,"/from/"+i.value)).replace(/\/to\/[^\/]+/,"/to/"+o.value),document.querySelector("div.content-header td.form-buttons button").setAttribute("onclick",t),document.querySelector("div.content-header-floating td.form-buttons button").setAttribute("onclick",t)),this}};"function"==typeof self.addEventListener&&self.addEventListener("load",versioning.init.bind(versioning));
//# sourceMappingURL=app.min.js.map