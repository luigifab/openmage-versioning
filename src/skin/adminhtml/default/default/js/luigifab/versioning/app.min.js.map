{"version":3,"sources":["app.js"],"sourcesContent":["/**\n * Created J/22/12/2011\n * Updated J/26/05/2022\n *\n * Copyright 2011-2022 | Fabrice Creuzot (luigifab) <code~luigifab~fr>\n * https://www.luigifab.fr/openmage/versioning\n *\n * This program is free software, you can redistribute it or modify\n * it under the terms of the GNU General Public License (GPL) as published\n * by the free software foundation, either version 2 of the license, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but without any warranty, without even the implied warranty of\n * merchantability or fitness for a particular purpose. See the\n * GNU General Public License (GPL) for more details.\n */\n\nif (window.NodeList && !NodeList.prototype.forEach) {\n\tNodeList.prototype.forEach = function (callback, that, i) {\n\t\tthat = that || window;\n\t\tfor (i = 0; i < this.length; i++)\n\t\t\tcallback.call(that, this[i], i, this);\n\t};\n}\n\nvar versioning = new (function () {\n\n\t\"use strict\";\n\tthis.svg   = null;\n\tthis.width = 197;\n\n\tthis.init = function () {\n\n\t\tif (document.getElementById('versioning_grid_table') && document.querySelector('table.data tbody input')) {\n\t\t\tconsole.info('versioning.app - hello');\n\t\t\tthis.drawGraph(self.versioningIds, self.versioningCols).initDiff();\n\t\t}\n\t\telse if (document.getElementById('versioning_history_grid_table') && document.querySelector('table.data tbody button')) {\n\t\t\tconsole.info('versioning.app - hello');\n\t\t\tdocument.querySelector('table.data tbody button').click();\n\t\t}\n\t};\n\n\tthis.loader = function () {\n\t\tdocument.querySelector('body').classList.add('fabload');\n\t};\n\n\tthis.decode = function (data) {\n\t\t// utf-8 avec Webkit (https://stackoverflow.com/q/3626183)\n\t\treturn decodeURIComponent(escape(atob(data)));\n\t};\n\n\t// confirmation des pages de maintenance\n\tthis.confirmFlag = function (url, title, content) {\n\n\t\ttry {\n\t\t\t// avec l'apijs\n\t\t\t// utilise une jolie boîte de dialogue\n\t\t\tapijs.dialog.dialogConfirmation(\n\t\t\t\ttitle, // title\n\t\t\t\tthis.decode(content),         // text\n\t\t\t\tversioning.actionConfirmFlag, // callback\n\t\t\t\turl,   // args\n\t\t\t\t'versioning ' + document.getElementById('scmtype').textContent // icon\n\t\t\t);\n\n\t\t\treturn false;\n\t\t}\n\t\tcatch (e) {\n\t\t\tconsole.error(e);\n\t\t\ttry { apijs.dialog.actionClose(); } catch (ignore) { }\n\n\t\t\ttry {\n\t\t\t\t// sans l'apijs\n\t\t\t\t// demande de confirmation\n\t\t\t\tif (confirm(this.decode(content).replace(/\\[[^\\]]+]/g, ''))) {\n\t\t\t\t\tthis.loader();\n\t\t\t\t\tself.location.href = url;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (ee) {\n\t\t\t\tconsole.error(ee);\n\n\t\t\t\t// en dernier recours\n\t\t\t\t// demande de confirmation\n\t\t\t\tif (confirm(Translator.translate('Are you sure?'))) {\n\t\t\t\t\tthis.loader();\n\t\t\t\t\tself.location.href = url;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.actionConfirmFlag = function (url) {\n\t\tversioning.loader();\n\t\tapijs.dialog.remove('waiting', 'lock'); // obligatoire sinon demande de confirmation de quitter la page\n\t\tself.location.href = url;\n\t};\n\n\tthis.cancelFlag = function (url) {\n\t\tthis.loader();\n\t\tself.location.href = url;\n\t};\n\n\t// confirmation de mise à jour\n\tthis.confirmUpgrade = function (url, title) {\n\n\t\ttry {\n\t\t\t// avec l'apijs\n\t\t\t// utilise une jolie boîte de dialogue\n\t\t\turl.match(/revision\\/(\\w+)\\//);\n\t\t\tapijs.dialog.dialogFormOptions(\n\t\t\t\ttitle.replace('§', RegExp.$1),    // title\n\t\t\t\tthis.decode(self.versioningText), // text\n\t\t\t\turl,  // action\n\t\t\t\tversioning.actionConfirmUpgrade,  // callback (en deux temps, vérification puis redirection)\n\t\t\t\tnull, // args\n\t\t\t\t'versioning ' + document.getElementById('scmtype').textContent // icon\n\t\t\t);\n\n\t\t\treturn false;\n\t\t}\n\t\tcatch (e) {\n\t\t\tconsole.error(e);\n\t\t\ttry { apijs.dialog.actionClose(); } catch (ignore) { }\n\n\t\t\ttry {\n\t\t\t\t// sans l'apijs\n\t\t\t\t// simule la boîte de dialogue de l'apijs\n\t\t\t\tvar data = document.createElement('div'),\n\t\t\t\t    text = this.decode(self.versioningText).replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\\[/g, '<').replace(/]/g, '>'),\n\t\t\t\t    icon = document.getElementById('scmtype').textContent;\n\n\t\t\t\turl.match(/revision\\/(\\w+)\\//);\n\t\t\t\tdata.innerHTML =\n\t\t\t\t\t'<div class=\"fake options versioning ' + icon + ' ready\" id=\"apijsDialog\">' +\n\t\t\t\t\t\t'<form method=\"get\" action=\"' + url + '\" class=\"fake options versioning ' + icon + ' ready\" onsubmit=\"return versioning.actionConfirmUpgrade(true);\" id=\"apijsBox\">' +\n\t\t\t\t\t\t\t'<h1>' + title.replace('§', RegExp.$1) + '</h1>' +\n\t\t\t\t\t\t\t'<div class=\"bbcode\">' + text + '</div>' +\n\t\t\t\t\t\t\t'<div class=\"control\">' +\n\t\t\t\t\t\t\t\t'<button type=\"submit\" class=\"confirm\">Valider</button>' +\n\t\t\t\t\t\t\t\t'<button type=\"button\" class=\"cancel\" onclick=\"versioning.closeConfirmUpgrade();\">Annuler</button>' +\n\t\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t'</form>' +\n\t\t\t\t\t'</div>';\n\n\t\t\t\tdocument.querySelector('body').appendChild(data);\n\t\t\t\tdocument.querySelector('div.bbcode input').focus();\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tcatch (ee) {\n\t\t\t\tconsole.error(ee);\n\n\t\t\t\t// en dernier recours\n\t\t\t\t// demande de confirmation\n\t\t\t\tif (confirm(Translator.translate('Are you sure?'))) {\n\t\t\t\t\tthis.loader();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.closeConfirmUpgrade = function () {\n\t\tdocument.getElementById('apijsDialog').remove();\n\t};\n\n\tthis.actionConfirmUpgrade = function (action) {\n\n\t\t// avec l'apijs, en deux temps\n\t\t// validation du formulaire si la fonction callback avec son paramètre args renvoie true, callback(false, args)\n\t\t// appelle la fonction callback avec ses paramètres action et args après la validation du dialogue, callback(action, args)\n\t\tif (action === false)\n\t\t\treturn true;\n\n\t\tversioning.loader();\n\n\t\t// sans l'apijs\n\t\tif (action === true) {\n\t\t\tdocument.querySelector('div.bbcode').setAttribute('style', 'visibility:hidden;');\n\t\t\tdocument.querySelector('div.control').setAttribute('style', 'visibility:hidden;');\n\t\t}\n\t\t// avec l'apijs, en deux temps\n\t\telse {\n\t\t\tapijs.dialog.remove('waiting', 'lock'); // obligatoire sinon demande de confirmation de quitter la page\n\t\t\tself.location.href = action + apijs.serialize(document.getElementById('apijsBox')).replace(/[=&]/g, '/');\n\t\t}\n\n\t\treturn true;\n\t};\n\n\t// affichage de l'historique\n\tthis.history = function (elem, content) {\n\n\t\tdocument.querySelectorAll('table.data tbody tr[class]').forEach(function (elem) { elem.classList.remove('current'); });\n\t\tdocument.querySelector('pre').innerHTML = this.decode(content) + \"\\n\\n\";\n\n\t\telem.parentNode.parentNode.classList.add('current');\n\t\treturn false;\n\t};\n\n\t// Représentation des branches\n\t// » Utilise Raphael.js 2.3.0 (93,4 ko) pour la création de l'image SVG - https://github.com/DmitryBaranovskiy/raphael\n\t// » Utilise la fonction innerSVG (1,4 ko) pour l'ajout des dégradés - https://code.google.com/p/innersvg/\n\t// » Pour chaque commit crée un point éventuellement suivi d'une étiquette avec le nom de la branche\n\t// » Crée ensuite les lignes entres les points\n\tthis.drawGraph = function (data, cols) {\n\n\t\tvar x, y, pX, pY, elem, gradients = '',\n\t\t\tcommits   = Object.keys(data).map(function (key) { return data[key]; }), // les commits sous forme d'un array\n\t\t\ttableRows = document.querySelectorAll('table.data tbody tr'), rows = tableRows.length - 1, // les lignes du tableau html\n\t\t\tcolors = [], styles = [], names = [], tops = [], bottoms = [],\n\t\t\tgrad = 0, offsetTop = 0, graphHeight = 0, topPoint = 0, miHeight = 0, dMiHeight = 0;\n\n\t\t// https://stackoverflow.com/a/1129270\n\t\t// inverse l'ordre du tableau\n\t\tcommits.sort(function (a, b) {\n\t\t\tif (a.row > b.row)\n\t\t\t\treturn -1;\n\t\t\tif (a.row < b.row)\n\t\t\t\treturn 1;\n\t\t\treturn 0;\n\t\t});\n\n\t\t// recheche de la hauteur et de la position du graphique\n\t\t// offsetTop = la position du haut du graphique (à partir du haut du document)\n\t\t//  topPoint = la position du haut de la première ligne dans le tableau (à partir du haut du document)\n\t\toffsetTop   = this.getTopPosition(tableRows[0]) - 1;\n\t\tgraphHeight = this.getTopPosition(tableRows[rows]) + tableRows[rows].offsetHeight - offsetTop - 1;\n\n\t\t// initialisation du graphique\n\t\t// canvas = l'élément svg\n\t\tthis.svg = new Raphael(document.getElementById('versioning_grid_table').parentNode);\n\t\tthis.svg.setSize(this.width, graphHeight);\n\t\tthis.svg.canvas.setAttribute('style', 'top:' + offsetTop + 'px;');\n\t\tthis.svg.canvas.setAttribute('class', 'k k0');\n\t\tthis.svg.canvas.setAttribute('id', 'versioning_graph');\n\t\tthis.svg.canvas.setAttribute('onmouseover', 'versioning.mouseOver(true);');\n\t\tthis.svg.canvas.parentNode.setAttribute('onmouseleave', 'versioning.mouseOver(false);');\n\n\t\t// génération des couleurs\n\t\t// mémorise en même temps le point le plus haut/bas de chaque branche\n\t\tRaphael.getColor.reset();\n\t\tRaphael.getColor();\n\t\tcolors.push(Raphael.getColor());\n\n\t\tfor (x = 0; x <= cols; x++) {\n\n\t\t\tRaphael.getColor();\n\t\t\tRaphael.getColor();\n\t\t\tcolors.push(Raphael.getColor());\n\n\t\t\tstyles.push('svg.k' + x + ' .k:not(.k' + x + ') { opacity:0.4; }');\n\t\t\tstyles.push('table.k' + x + ' .k:not(.k' + x + ') { color:#CCC; }');\n\t\t\tstyles.push('table.k' + x + ' .k:not(.k' + x + ') button { opacity:0; visibility:hidden; }');\n\t\t}\n\n\t\tcommits.forEach(function (commit) {\n\n\t\t\tcommit.color = colors[commit.col];\n\t\t\tcommit.klass = 'k k' + commit.col;\n\n\t\t\tbottoms[commit.col] = commit.revision;\n\t\t\tif (!tops[commit.col])\n\t\t\t\ttops[commit.col] = commit.revision;\n\t\t});\n\n\t\t// Pour chaque commit (du haut vers le bas)\n\t\t// offsetTop = la position du haut du graphique (à partir du haut du document)\n\t\t//  topPoint = la position du haut de la première ligne dans le tableau (à partir du haut du document)\n\t\t//  miHeight = le milieu de la ligne dans le tableau\n\t\t//      rows = le nombre de ligne dans le tableau (de 0 à tableRows-1)\n\t\t//       row = le numéro de la ligne dans le tableau (max = la première ligne, 0 = la dernière ligne)\n\t\tcommits.forEach(function (commit) {\n\n\t\t\t// recherche de la position du point\n\t\t\ttopPoint = this.getTopPosition(tableRows[rows - commit.row]) - offsetTop;\n\t\t\tmiHeight = tableRows[rows - commit.row].offsetHeight / 2;\n\n\t\t\t// sur X (position horizontale) le  25 correspond à l'espace entre les colonnes, donc entre deux branches\n\t\t\t// sur X (position horizontale) le +20 permet de ne pas coller la première branche au bord\n\t\t\ty = topPoint + miHeight;\n\t\t\tx = 25 * commit.col + 20;\n\n\t\t\t// dessine un point\n\t\t\tthis.svg.circle(x, y, 3.5)\n\t\t\t\t.attr('fill', commit.color)\n\t\t\t\t.attr('stroke', 'none')\n\t\t\t\t.attr('class', commit.klass);\n\n\t\t\t// écrit un texte dans une étiquette\n\t\t\t// en profite également pour vérifier la largeur du graphique\n\t\t\tif ((commit.branch.length > 0) && (names.indexOf(commit.branch) < 0)) {\n\n\t\t\t\tnames.push(commit.branch);\n\n\t\t\t\telem = this.svg.text(x + 13, y - 0.3, commit.branch)\n\t\t\t\t\t.attr('fill', commit.color)\n\t\t\t\t\t.attr('text-anchor', 'start')\n\t\t\t\t\t.attr('class', commit.klass);\n\n\t\t\t\tpX = x + 3.2 + 8 + elem.getBBox().width + 7;       // variable temporaire\n\t\t\t\tthis.svg.path(\n\t\t\t\t\t'M ' + (x + 3.2) + ',' + (y - 0.4) +          // point de départ au niveau du point\n\t\t\t\t\t' L ' + (x + 3.2 + 8) + ',' + (y - 0.4 - 8) + // en haut à gauche\n\t\t\t\t\t' L ' + (pX) + ',' + (y - 0.4 - 8) +          // en haut à droite\n\t\t\t\t\t' L ' + (pX) + ',' + (y - 0.4 + 8) +          // en bas à droite\n\t\t\t\t\t' L ' + (x + 3.2 + 8) + ',' + (y - 0.4 + 8) + // en bas à gauche\n\t\t\t\t\t' Z')\n\t\t\t\t\t.attr('stroke', commit.color)\n\t\t\t\t\t.attr('fill', 'white')\n\t\t\t\t\t.attr('fill-opacity', '0.7')\n\t\t\t\t\t.attr('stroke-opacity', '0.2')\n\t\t\t\t\t.attr('class', commit.klass)\n\t\t\t\t\t.toFront();\n\t\t\t\telem.toFront(); // repasse le texte au dessus de l'étiquette\n\n\t\t\t\tif (pX > this.width)\n\t\t\t\t\tthis.width = pX;\n\t\t\t}\n\n\t\t\t// ligne vers le parent (donc un peu plus bas)\n\t\t\t// s'il existe, sinon vers le bas du graphique\n\t\t\tcommit.parents.forEach(function (ref, parent) {\n\n\t\t\t\tparent = (ref.length > 0) ? data[ref] : undefined;\n\n\t\t\t\tif (typeof parent == 'object') {\n\n\t\t\t\t\t// recherche de la position du point\n\t\t\t\t\ttopPoint = this.getTopPosition(tableRows[rows - parent.row]) - offsetTop;\n\t\t\t\t\tmiHeight = tableRows[rows - parent.row].offsetHeight / 2;\n\n\t\t\t\t\t// sur X (position horizontale) le 25 correspond à l'espace entre les colonnes, donc entre deux branches\n\t\t\t\t\t// sur X (position horizontale) le +20 permet de ne pas coller la première branche au bord\n\t\t\t\t\tpY = topPoint + miHeight;\n\t\t\t\t\tpX = 25 * parent.col + 20;\n\n\t\t\t\t\tif (parent.col === commit.col) {\n\t\t\t\t\t\t// dessine une ligne verticale\n\t\t\t\t\t\tthis.svg.path(['M', x, y, 'V', pY])\n\t\t\t\t\t\t\t.attr('stroke', commit.color)\n\t\t\t\t\t\t\t.attr('stroke-width', 1.7)\n\t\t\t\t\t\t\t.attr('class', commit.klass)\n\t\t\t\t\t\t\t.toBack();\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// dégradé manuel car Raphael.js ne permet pas de définir un dégradé sur un path sur stroke\n\t\t\t\t\t\t// dans un sens ou dans l'autre, bref on veut pas savoir\n\t\t\t\t\t\t// attention pour les lignes en travers pas de kX\n\t\t\t\t\t\tgradients += '<linearGradient id=\"manGrad' + grad + '\" x1=\"0\" y1=\"0\" x2=\"100%\" y2=\"0\">' +\n\t\t\t\t\t\t\t'<stop offset=\"0\" stop-color=\"' + ((x > pX) ? parent.color : commit.color) + '\"></stop>' +\n\t\t\t\t\t\t\t'<stop offset=\"100%\" stop-color=\"' + ((x > pX) ? commit.color : parent.color) + '\"></stop>' +\n\t\t\t\t\t\t'</linearGradient>';\n\n\t\t\t\t\t\tdMiHeight = tableRows[rows - parent.row].offsetHeight / 2;\n\t\t\t\t\t\tdMiHeight += miHeight;\n\n\t\t\t\t\t\tif ((parent.revision === tops[parent.col]) && (y + dMiHeight < pY)) {\n\t\t\t\t\t\t\t// dessine une ligne en travers\n\t\t\t\t\t\t\telem = this.svg.path(['M', x, y, 'T', pX, y + dMiHeight]);\n\t\t\t\t\t\t\telem.node.setAttribute('stroke', 'url(#manGrad' + grad + ')');\n\t\t\t\t\t\t\telem.attr('stroke-width', 1.6).attr('class', 'k').toBack();\n\t\t\t\t\t\t\t// dessise une ligne verticale\n\t\t\t\t\t\t\tthis.svg.path(['M', pX, y + dMiHeight, 'V', pY])\n\t\t\t\t\t\t\t\t.attr('stroke', parent.color)\n\t\t\t\t\t\t\t\t.attr('stroke-width', 1.7)\n\t\t\t\t\t\t\t\t.attr('class', 'k')\n\t\t\t\t\t\t\t\t.toBack();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if ((commit.revision === bottoms[commit.col]) && (pY > y + dMiHeight) && (commit.parents.length === 1)) {\n\t\t\t\t\t\t\t// dessise une ligne verticale\n\t\t\t\t\t\t\tthis.svg.path(['M', x, y, 'V', pY - dMiHeight])\n\t\t\t\t\t\t\t\t.attr('stroke', commit.color)\n\t\t\t\t\t\t\t\t.attr('stroke-width', 1.7)\n\t\t\t\t\t\t\t\t.attr('class', 'k')\n\t\t\t\t\t\t\t\t.toBack();\n\t\t\t\t\t\t\t// dessine une ligne en travers\n\t\t\t\t\t\t\telem = this.svg.path(['M', x, pY - dMiHeight, 'T', pX, pY]);\n\t\t\t\t\t\t\telem.node.setAttribute('stroke', 'url(#manGrad' + grad + ')');\n\t\t\t\t\t\t\telem.attr('stroke-width', 1.6).attr('class', 'k').toBack();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t// dessine une ligne en travers\n\t\t\t\t\t\t\telem = this.svg.path(['M', x, y, 'T', pX, pY]);\n\t\t\t\t\t\t\telem.node.setAttribute('stroke', 'url(#manGrad' + grad + ')');\n\t\t\t\t\t\t\telem.attr('stroke-width', 1.6).attr('class', 'k').toBack();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tgrad += 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (ref.length > 0) {\n\t\t\t\t\t// dessine une ligne verticale vers le bas du graphique\n\t\t\t\t\tthis.svg.path(['M', x, y, 'V', graphHeight])\n\t\t\t\t\t\t.attr('stroke', commit.color)\n\t\t\t\t\t\t.attr('stroke-width', 1.7)\n\t\t\t\t\t\t.attr('class', commit.klass)\n\t\t\t\t\t\t.toBack();\n\t\t\t\t}\n\n\t\t\t}, this); // pour que ci-dessus this = this\n\n\t\t\telem = tableRows[rows - commit.row];\n\t\t\telem.setAttribute('onclick', \"versioning.updateClass(this.getAttribute('class'));\");\n\t\t\telem.setAttribute('class', ((commit.row % 2) < 1) ? commit.klass : 'even ' + commit.klass);\n\t\t\telem.removeAttribute('title');\n\n\t\t}, this); // pour que ci-dessus this = this\n\n\t\t// une seule fois sinon fonctionne que pour le dernier ajout avec Edge 14\n\t\tif (gradients.length > 0)\n\t\t\tdocument.querySelector('svg defs').innerSVG = gradients;\n\n\t\t// ajoute les styles pour les animations\n\t\telem = document.createElement('style');\n\t\telem.setAttribute('type', 'text/css');\n\t\telem.setAttribute('id', 'versioning_styles');\n\t\telem.appendChild(document.createTextNode(styles.join(\"\\n\")));\n\t\tdocument.querySelector('head').appendChild(elem);\n\n\t\treturn this;\n\t};\n\n\tthis.getTopPosition = function (elem) {\n\t\tvar bodyRect = document.querySelector('body').getBoundingClientRect(), elemRect = elem.getBoundingClientRect();\n\t\treturn elemRect.top - bodyRect.top;\n\t};\n\n\tthis.mouseOver = function (show) {\n\t\tthis.svg.canvas.style.width = show ? this.width + 'px' : '197px';\n\t\tthis.svg.canvas.style.pointerEvents = show ? 'none' : 'inherit';\n\t};\n\n\tthis.updateClass = function (klass) {\n\t\tthis.svg.canvas.setAttribute('class', klass);\n\t\tdocument.getElementById('versioning_grid_table').setAttribute('class', 'data ' + klass);\n\t};\n\n\t// gestion des cases du diff\n\tthis.initDiff = function () {\n\n\t\tvar a = 1, b = 1, c = true;\n\t\tdocument.querySelectorAll('table.data input[type=\"radio\"]').forEach(function (elem) {\n\t\t\telem.setAttribute('onchange', 'versioning.goDiff(' + (c ? a++ : b++) + ', ' + (c ? 'false' : 'true') + ');');\n\t\t\telem.removeAttribute('disabled'); // lors d'un F5 c'est utile\n\t\t\tc = !c;\n\t\t});\n\n\t\tdocument.querySelector('table.data tr:last-child input[name=\"d1\"]').setAttribute('disabled', 'disabled');\n\t\tdocument.querySelector('table.data tr:first-child input[name=\"d2\"]').setAttribute('disabled', 'disabled');\n\t\tdocument.querySelector('table.data input[name=\"d1\"]:not([disabled])').checked = true;\n\t\tdocument.querySelector('table.data input[name=\"d2\"]:not([disabled])').checked = true;\n\n\t\treturn this.goDiff();\n\t};\n\n\tthis.goDiff = function (url, second) {\n\n\t\tvar ia = document.querySelector('table.data input[name=\"d1\"]:checked'),\n\t\t    ib = document.querySelector('table.data input[name=\"d2\"]:checked'),\n\t\t    pa = parseInt(ia.getAttribute('onchange').replace(/\\D/g, ''), 10),\n\t\t    pb = parseInt(ib.getAttribute('onchange').replace(/\\D/g, ''), 10),\n\t\t    onclick;\n\n\t\tif (typeof url == 'string') {\n\t\t\tthis.loader();\n\t\t\tself.location.href = url;\n\t\t}\n\t\telse {\n\t\t\tif (second === true) {\n\t\t\t\tif (pa >= pb) {\n\t\t\t\t\tia = ib.parentNode.parentNode.previousElementSibling.querySelector('input[name=\"d1\"]');\n\t\t\t\t\tia.checked = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (pa >= pb) {\n\t\t\t\t\tib = ia.parentNode.parentNode.nextElementSibling.querySelector('input[name=\"d2\"]');\n\t\t\t\t\tib.checked = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tonclick = document.querySelector('div.content-header td.form-buttons button').getAttribute('onclick');\n\t\t\tonclick = onclick.replace(/\\/from\\/[^\\/]+/, '/from/' + ib.value);\n\t\t\tonclick = onclick.replace(/\\/to\\/[^\\/]+/, '/to/' + ia.value);\n\n\t\t\tdocument.querySelector('div.content-header td.form-buttons button').setAttribute('onclick', onclick);\n\t\t\tdocument.querySelector('div.content-header-floating td.form-buttons button').setAttribute('onclick', onclick);\n\t\t}\n\n\t\treturn this;\n\t};\n\n})();\n\nif (typeof self.addEventListener == 'function')\n\tself.addEventListener('load', versioning.init.bind(versioning));"],"names":["window","NodeList","prototype","forEach","callback","that","i","this","length","call","versioning","svg","width","init","document","getElementById","querySelector","console","info","drawGraph","self","versioningIds","versioningCols","initDiff","click","loader","classList","add","decode","data","decodeURIComponent","escape","atob","confirmFlag","url","title","content","apijs","dialog","dialogConfirmation","actionConfirmFlag","textContent","e","error","actionClose","ignore","confirm","replace","location","href","ee","Translator","translate","remove","cancelFlag","confirmUpgrade","match","dialogFormOptions","RegExp","$1","versioningText","actionConfirmUpgrade","createElement","text","icon","innerHTML","appendChild","focus","closeConfirmUpgrade","action","setAttribute","serialize","history","elem","querySelectorAll","parentNode","cols","x","y","pX","pY","offsetTop","graphHeight","topPoint","miHeight","dMiHeight","gradients","commits","Object","keys","map","key","tableRows","rows","colors","styles","names","tops","bottoms","grad","sort","a","b","row","getTopPosition","offsetHeight","Raphael","setSize","canvas","getColor","reset","push","commit","color","col","klass","revision","circle","attr","branch","indexOf","getBBox","path","toFront","parents","ref","parent","undefined","toBack","node","removeAttribute","innerSVG","createTextNode","join","bodyRect","getBoundingClientRect","top","mouseOver","show","style","pointerEvents","updateClass","c","checked","goDiff","second","ia","ib","pa","parseInt","getAttribute","pb","previousElementSibling","nextElementSibling","onclick","value","addEventListener","bind"],"mappings":"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"}